<script>
    document.getElementById('convertButton').addEventListener('click', () => {
        const htmlContent = document.getElementById('htmlInput').value;

        if (!htmlContent.trim()) {
            alert("Please paste the HTML content into the text box.");
            return;
        }

        // Regular expressions for extraction
        const chunkRegex = /<div[^>]*class="chunk"[^>]*>([\s\S]*?)<\/div>/g;
        const categoryRegex = /<h2[^>]*class="chunk-title-wrapper"[^>]*>\s*<div[^>]*class="chunk-title"[^>]*>([^<]+)<\/div>/;
        const titleRegex = /<h3[^>]*class="chunk-title-wrapper"[^>]*>\s*<div[^>]*class="chunk-title"[^>]*>([^<]+)<\/div>/;
        const bodyRegex = /<div[^>]*class="chunk-content-wrapper"[^>]*>([\s\S]*?)<\/div>/;

        const chunks = [...htmlContent.matchAll(chunkRegex)];
        console.log("Chunks Found:", chunks);

        const jsonOutput = [];
        let currentCategory = "Uncategorized";

        chunks.forEach(chunk => {
            const chunkContent = chunk[1];
            console.log("Processing Chunk:", chunkContent);

            // Update category if a new one is found
            const categoryMatch = chunkContent.match(categoryRegex);
            if (categoryMatch) {
                currentCategory = categoryMatch[1].trim();
                console.log("Updated Category:", currentCategory);
            }

            // Extract title and body for the current chunk
            const titleMatch = chunkContent.match(titleRegex);
            const bodyMatch = chunkContent.match(bodyRegex);

            const title = titleMatch?.[1]?.trim() || "Untitled";
            const body = bodyMatch?.[1]?.trim() || "No content available";

            console.log("Extracted Title:", title);
            console.log("Extracted Body:", body);

            // Add to JSON output
            jsonOutput.push({
                type_id: 1870,
                category: currentCategory,
                title,
                body
            });
        });

        if (jsonOutput.length === 0) {
            alert("No valid data found in the provided HTML.");
            return;
        }

        const blob = new Blob([JSON.stringify(jsonOutput, null, 4)], { type: "application/json" });
        const downloadLink = document.getElementById('downloadLink');
        downloadLink.href = URL.createObjectURL(blob);
        downloadLink.download = "converted_data.json";
        downloadLink.style.display = "inline";
        downloadLink.innerText = "Download JSON";
    });
</script>
